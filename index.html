<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeek Chatbot</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007bff;
            --primary-hover-color: #0056b3;
            --background-color: #f0f2f6;
            --chat-bg-color: #ffffff;
            --user-bubble-color: #e0f7fa; /* Light Blue */
            --ai-bubble-color: #f8f9fa;   /* Off-white */
            --text-color: #333;
            --border-color: #ddd;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --code-bg-color: #e9ecef;
            --code-border-color: #dee2e6;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
            overflow-y: auto; /* Allow body to scroll if content is too tall */
        }

        .chatbot-container {
            background-color: var(--chat-bg-color);
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow-light);
            width: 100%;
            max-width: 700px;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Hide scrollbar for container itself */
            min-height: 80vh; /* Minimum height for a good appearance */
            max-height: 95vh; /* Max height to fit viewport, allowing body scroll */
            position: relative; /* For sticky input area */
        }

        .chatbot-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            text-align: center;
            font-size: 1.5em;
            font-weight: 700;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            flex-shrink: 0; /* Don't shrink header */
        }

        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto; /* Scrollable message area */
            display: flex;
            flex-direction: column;
            gap: 10px;
            scroll-behavior: smooth;
            /* Ensure enough space for fixed input */
            padding-bottom: 90px; /* Adjust based on chat-input-area height */
        }

        .message-bubble {
            max-width: 85%;
            padding: 12px 18px;
            border-radius: 20px;
            line-height: 1.5;
            word-wrap: break-word;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            font-size: 0.95em;
        }

        .user-message {
            background-color: var(--user-bubble-color);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .ai-message {
            background-color: var(--ai-bubble-color);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        /* Markdown rendering within messages */
        .ai-message h1, .ai-message h2, .ai-message h3, .ai-message h4 {
            margin-top: 1em;
            margin-bottom: 0.5em;
            padding-bottom: 0.2em;
            border-bottom: 1px solid var(--border-color);
            font-size: 1.2em; /* Adjust heading sizes */
        }
        .ai-message h2 { font-size: 1.15em; }
        .ai-message h3 { font-size: 1.1em; }

        .ai-message p {
            margin-bottom: 0.5em;
        }

        .ai-message pre {
            background-color: var(--code-bg-color);
            padding: 10px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Fira Code', monospace;
            font-size: 0.85em;
            border: 1px solid var(--code-border-color);
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .ai-message code:not(pre code) { /* Inline code */
            background-color: var(--code-bg-color);
            padding: 2px 4px;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
            border: 1px solid var(--code-border-color);
        }

        .ai-message table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        .ai-message th, .ai-message td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: left;
        }
        .ai-message th {
            background-color: #e9ecef;
            font-weight: bold;
        }

        .ai-message hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 15px 0;
        }

        .ai-message ul, .ai-message ol {
            margin-left: 20px;
            padding-left: 0;
            margin-bottom: 0.5em;
        }
        .ai-message li {
            margin-bottom: 5px;
        }

        .chat-input-area {
            display: flex;
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            background-color: var(--chat-bg-color);
            flex-shrink: 0; /* Don't shrink input area */

            /* --- Fixed Position Logic --- */
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%; /* Ensure it spans full width */
            box-sizing: border-box; /* Include padding/border in width */
            /* --- End Fixed Position Logic --- */
        }

        .chat-input-area input {
            flex-grow: 1;
            padding: 12px 20px;
            border: 1px solid var(--border-color);
            border-radius: 25px;
            font-size: 1em;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .chat-input-area input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .chat-input-area button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            margin-left: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            flex-shrink: 0;
        }

        .chat-input-area button:hover {
            background-color: var(--primary-hover-color);
            transform: translateY(-1px);
        }

        .chat-input-area button:active {
            transform: translateY(0);
        }

        /* Typing indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            height: 1.5em; /* Ensure it doesn't collapse */
        }
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: var(--text-color);
            border-radius: 50%;
            margin: 0 2px;
            animation: bounce 0.6s infinite alternate;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0% { transform: translateY(0); opacity: 0.8; }
            100% { transform: translateY(-5px); opacity: 0.3; }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                padding: 0;
                align-items: stretch;
            }
            .chatbot-container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
                max-height: 100vh; /* Full height on smaller screens */
            }
        }
    </style>
</head>
<body>
    <div class="chatbot-container">
        <div class="chatbot-header">DeepSeek AI Chat</div>
        <div class="chat-messages" id="chatMessages">
            <div class="message-bubble ai-message">Hello! I'm DeepSeek. How can I assist you today?</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="userInput" placeholder="Type your message..." autocomplete="off">
            <button id="sendButton">
                Send
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16">
                    <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.417.29L.767 6.118l.452.18.082-.887.417-.29zM12.787 1.14l-11.417 4.542L1.874 5.37l11.417-4.542-1.748-1.748L0 6.643l.767-.306 14.502-5.772.65-.65a.5.5 0 0 0-.082-.887L1.874 5.37l11.417-4.542z"/>
                    <path d="M15.854.146a.5.5 0 0 1 .11.54L13.06 12.338a.5.5 0 0 1-.92.054l-4.256-4.256-.417-.29a.5.5 0 0 0-.082-.887L.767 5.855l14.502-5.772L15.964.686a.5.5 0 0 0-.082-.887zM1.874 5.37l11.417-4.542L15.964.686a.5.5 0 0 0-.082-.887L1.874 5.37zM.767 5.855l-.452.18a.5.5 0 0 0-.082.887l.417.29L.767 6.118l.452.18.082-.887L.767 5.855z"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // ⚠️ SECURITY WARNING: Never hardcode API keys in production.
        // This is for demonstration and testing purposes only.
        const OPENROUTER_API_KEY = "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";
        const OPENROUTER_API_URL = "https://openrouter.ai/api/v1/chat/completions";
        const MODEL_NAME = "deepseek/deepseek-r1-0528-qwen3-8b:free";

        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');

        // Store chat history for context
        const chatHistory = [{ role: "assistant", content: "Hello! I'm DeepSeek. How can I assist you today?" }];

        // Basic Markdown to HTML converter (simplified for common elements)
        function markdownToHtml(markdownText) {
            let html = markdownText
                // Headings (H1, H2, H3, H4 - simplified)
                .replace(/^#### (.*$)/gm, '<h4>$1</h4>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                // Horizontal Rules
                .replace(/^-{3,}\s*$/gm, '<hr>')
                // Bold text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/__(.*?)__/g, '<strong>$1</strong>')
                // Italic text
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/_(.*?)_/g, '<em>$1</em>');

            // Code blocks (multiline, assumes ```language\ncode\n```)
            html = html.replace(/```(\w+)?\n([\s\S]*?)```/g, function(match, lang, code) {
                const languageClass = lang ? `language-${lang}` : '';
                // Basic HTML escaping for code content
                const escapedCode = code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return `<pre><code class="${languageClass}">${escapedCode}</code></pre>`;
            });

            // Inline code
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

            // Lists (basic ul/ol)
            html = html.replace(/^\s*(\*|\-|\+)\s+(.*)/gm, '<li>$2</li>') // unordered list items
                       .replace(/^\s*(\d+)\.\s+(.*)/gm, '<li>$2</li>'); // ordered list items

            // Wrap loose list items in ul/ol tags. This is a very basic heuristic.
            // A more robust parser would build an AST.
            html = html.replace(/(<\/li>\s*<li>[^<]*<\/li>)+/g, '<ul>$&</ul>')
                       .replace(/<li>(.*?)<\/li>\n<li>(.*?)<\/li>/g, '<li>$1</li><li>$2</li>'); // Simple way to group

            // Tables (very basic - just splits by | and assumes first row is header)
            html = html.replace(/^\|(.+)\|(?:\s*)\|[-=\s]+\|(?:\s*)\|(.+)\|([\s\S]*?)(?=\n{2,}|\n?$)/gm, function(match, headerLine, sepLine, bodyLines) {
                let tableHtml = '<table><thead><tr>';
                headerLine.split('|').forEach(h => { if (h.trim()) tableHtml += `<th>${h.trim()}</th>`; });
                tableHtml += '</tr></thead><tbody>';
                bodyLines.split('\n').forEach(line => {
                    if (line.trim().startsWith('|') && line.trim().endsWith('|')) {
                        tableHtml += '<tr>';
                        line.split('|').forEach(cell => { if (cell.trim()) tableHtml += `<td>${cell.trim()}</td>`; });
                        tableHtml += '</tr>';
                    }
                });
                tableHtml += '</tbody></table>';
                return tableHtml;
            });


            // Convert remaining newlines to <br> for simple paragraph breaks (after other block elements)
            html = html.split('\n').map(p => {
                // If it's not already part of a block element (like pre, h, li, table)
                // This is a simple check, a full parser would be more robust.
                if (!p.trim().match(/^(<h|<pre|<ul|<ol|<table|<hr|<li)/)) {
                    return p + '<br>';
                }
                return p;
            }).join('');


            return html;
        }

        // Function to add a message to the chat display
        function addMessage(sender, message, isTyping = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message-bubble');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
            
            if (isTyping) {
                messageDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
                messageDiv.id = 'typingIndicator';
            } else {
                // For AI messages, parse markdown
                messageDiv.innerHTML = sender === 'ai' ? markdownToHtml(message) : message;
            }
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom
            return messageDiv; // Return the message element for potential updates
        }

        // Function to send message to OpenRouter API
        async function sendMessage() {
            const message = userInput.value.trim();
            if (message === "") return;

            addMessage('user', message);
            chatHistory.push({ role: "user", content: message });
            userInput.value = ''; // Clear input
            sendButton.disabled = true; // Disable button while AI is responding

            const typingMessageDiv = addMessage('ai', '', true); // Show typing indicator

            try {
                const response = await fetch(OPENROUTER_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: MODEL_NAME,
                        messages: chatHistory, // Send entire history for context
                        max_tokens: 500, // Optional: Limit response length
                        temperature: 0.7 // Optional: Adjust creativity
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} - ${errorData.message || 'Unknown error'}`);
                }

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;

                // Remove typing indicator
                if (typingMessageDiv) typingMessageDiv.remove();

                addMessage('ai', aiResponse);
                chatHistory.push({ role: "assistant", content: aiResponse });

            } catch (error) {
                console.error("Error fetching AI response:", error);
                // Remove typing indicator and show error message
                if (typingMessageDiv) typingMessageDiv.remove();
                addMessage('ai', `**Oops!** Something went wrong. Please try again later.<br>_Error: ${error.message}_`);
            } finally {
                sendButton.disabled = false; // Re-enable button
                chatMessages.scrollTop = chatMessages.scrollHeight; // Ensure scroll to bottom after action
            }
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter' && !sendButton.disabled) {
                sendMessage();
            }
        });

        // Initial scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
    </script>
</body>
</html>
